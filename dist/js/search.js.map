{"version":3,"sources":["search.js"],"names":["$","Drupal","behaviors","initSearchFacets","attach","context","settings","fn","selectpicker","Constructor","BootstrapVersion","resultsCount","data","$selects","clearSelections","showFilters","parents","addClass","showFormControls","setActiveItems","each","j","k","$selectpicker","options","find","a","b","val","url","window","location","href","replace","indexOf","push","on","document","ready","initSearchForm","$searchForm","$searchInput","$selectFilters","inputVal","$newSubmitButton","getSubmitUrl","opts","s","fs_p","f","g","length","pathname","param","attr","text","removeClass","click","e","preventDefault","trigger","jQuery"],"mappings":"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","file":"search.js","sourcesContent":["/**\n * @file\n * Custom JavaScript for UW Medicine.\n */\n\n(function($, Drupal) {\n  Drupal.behaviors.initSearchFacets = {\n    attach(context, settings) {\n      $.fn.selectpicker.Constructor.BootstrapVersion = \"4\";\n\n      const resultsCount = $(\"#main-container .views-view\").data(\n        \"view-total-rows\"\n      );\n\n      const $selects = $(\".selectpicker\");\n\n      const clearSelections = function() {\n        $selects.selectpicker(\"deselectAll\");\n      };\n      const showFilters = function() {\n        $selects.parents(\".dm-facets-selector\").addClass(\"on\");\n      };\n      const showFormControls = function() {\n        $(\".views-exposed-form, .submit-wrapper\").addClass(\"on\");\n      };\n\n      const setActiveItems = function() {\n        $selects.each((j, k) => {\n          const $selectpicker = $(k);\n          const options = [];\n          $selectpicker.find(\"option\").each((a, b) => {\n            const val = $(b).val();\n            const url = window.location.href.replace(/%3A/g, \":\");\n            if (url.indexOf(val) > 0) {\n              // $(b).attr(\"selected\", \"selected\");\n              options.push(val);\n            }\n          });\n          $selectpicker.selectpicker(\"val\", options);\n        });\n      };\n\n      $selects.selectpicker();\n\n      $selects.on(\"loaded.bs.select\", () => {\n        setActiveItems();\n      });\n\n      if (resultsCount == 0) {\n        clearSelections();\n      }\n\n      if (resultsCount > 0) {\n        showFilters();\n      }\n\n\n\n      $(document).ready(showFormControls);\n    }\n  };\n  Drupal.behaviors.initSearchForm = {\n    attach(context, settings) {\n      const $searchForm = $(\"section.content-topper form.views-exposed-form\");\n      const $searchInput = $searchForm.find(\"input[name=s]\");\n      const $selectFilters = $(\"section.content-topper .selectpicker\");\n      const inputVal = $searchInput.val();\n      const resultsCount = $(\"#main-container .views-view\").data(\n        \"view-total-rows\"\n      );\n\n      const $newSubmitButton = $(\n        \"section.content-topper .submit-wrapper a.btn\"\n      );\n\n      const getSubmitUrl = function() {\n        const opts = { s: $searchInput.val(), fs_p: [], f: [] };\n\n        $selectFilters.find(\"option:selected\").each((f, g) => {\n          const val = $(g).val();\n          if (val.length > 0) {\n            if ($selectFilters.length > 1) {\n              opts.fs_p[opts.fs_p.length] = val;\n            } else {\n              opts.f[opts.f.length] = val;\n            }\n          }\n        });\n\n        return `${window.location.pathname}?${$.param(opts)}`;\n      };\n\n      // http://stevie.uwmed.local/search/providers?fs_p[0]=language:15391&fs_p[1]=medical-service:506&fs_p[2]=medical-service:1321\n\n      $searchInput.attr(\"autocomplete\", \"off\");\n\n      if (inputVal.length > 0) {\n        $(\"section.content-topper .results-tip.with-results em\").text(\n          `${inputVal} (${resultsCount})`\n        );\n        $(\".results-tip.zero-results\").addClass(\"hidden\");\n        $(\".results-tip.with-results\").removeClass(\"hidden\");\n      }\n\n      $newSubmitButton.click(function() {\n        $(this).attr(\"href\", getSubmitUrl());\n      });\n\n      $searchForm.on(\"submit\", e => {\n        e.preventDefault();\n        $newSubmitButton.trigger(\"click\");\n      });\n    }\n  };\n})(jQuery, Drupal);\n"]}