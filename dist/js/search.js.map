{"version":3,"sources":["search.js"],"names":["$","Drupal","behaviors","initSearchFacets","attach","context","settings","fn","selectpicker","Constructor","BootstrapVersion","resultsCount","data","$selects","clearSelections","initSearchForm","$container","$searchForm","find","$selectFilters","$searchInput","inputVal","val","$latlngInput","$addressInput","optionsValues","map","get","$newSubmitButton","getSubmitUrl","opts","s","fs_p","f","each","g","length","latlng","l","window","location","pathname","param","attr","addClass","text","one","e","preventDefault","active","document","bind","on","trigger","keypress","which","blur","keydown","ready","focus","target","removeClass","getResultsCounts","searchString","$providersLink","$locationsLink","href","encodeURI","jQuery"],"mappings":"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","file":"search.js","sourcesContent":["/**\n * @file\n * Custom JavaScript for UW Medicine.\n */\n\n(($, Drupal) => {\n  Drupal.behaviors.initSearchFacets = {\n    attach(context, settings) {\n      $.fn.selectpicker.Constructor.BootstrapVersion = \"4\";\n\n      const resultsCount = $(\"#main-container .views-view\").data(\n        \"view-total-rows\"\n      );\n\n      // const $resetButton = $(\n      //   \"section.content-topper .submit-wrapper .btn-cta.reset\"\n      // );\n\n      const $selects = $(\"section.content-topper .selectpicker\");\n\n      const clearSelections = function () {\n        $selects.selectpicker(\"deselectAll\");\n      };\n\n      // const showFilters = function () {\n      //   $selects.parents(\".dm-facets-selector\").addClass(\"on\");\n      // };\n      //\n      // const showFormControls = function () {\n      //   $(\".views-exposed-form, .submit-wrapper\").addClass(\"on\");\n      // };\n\n      $selects.selectpicker();\n      //\n      // $selects.on(\"loaded.bs.select\", () => {\n      //   // console.log('selects loaded');\n      // });\n\n      if (resultsCount < 1) {\n        clearSelections();\n      }\n    }\n  };\n\n  Drupal.behaviors.initSearchForm = {\n    attach(context, settings) {\n      const $container = $(\"section.content-topper\");\n      const $searchForm = $container.find(\"form.views-exposed-form\");\n      const $selectFilters = $container.find(\".selectpicker, .dm-facets-widget-checkbox\");\n      const resultsCount = $(\"#main-container .views-view\").data(\n        \"view-total-rows\"\n      );\n      const $searchInput = $searchForm.find(\"input[name=s]\");\n      const inputVal = $searchInput.val();\n      const $latlngInput = $searchForm.find(\"input[name=latlng]\");\n      const $addressInput = $searchForm.find(\"input[name=l]\");\n      const optionsValues = $container\n        .find(\"option:selected, input:checked\")\n        .map(function () {\n          return $(this).val();\n        })\n        .get();\n\n      const $newSubmitButton = $container.find(\n        \".submit-wrapper a.btn-cta.submit\"\n      );\n\n      const getSubmitUrl = () => {\n        const opts = { s: $searchInput.val(), fs_p: [], f: [] };\n        $selectFilters.find(\"option:selected, input:checked\").each((f, g) => {\n          const val = $(g).val();\n          if (val.length > 0) {\n            if ($selectFilters.length > 1) {\n              opts.fs_p[opts.fs_p.length] = val;\n            } else {\n              opts.f[opts.f.length] = val;\n            }\n          }\n        });\n\n        // Add the value from the UML field, if it's available.\n        if ($latlngInput.length > 0 && $latlngInput.val() != '') {\n          opts.latlng = $latlngInput.val();\n        }\n        // Add the value from the address field, if it's available.\n        if ($addressInput.length > 0 && $addressInput.val() != '') {\n          opts.l = $addressInput.val();\n        }\n\n        return `${window.location.pathname}?${$.param(opts)}`;\n      };\n\n      // http://stevie.uwmed.local/search/providers?fs_p[0]=language:15391&fs_p[1]=medical-service:506&fs_p[2]=medical-service:1321\n\n      $searchInput.attr(\"autocomplete\", \"off\");\n\n      if (resultsCount > 0) {\n        $(\"body\").addClass(\"search-with-results\");\n      } else {\n        $(\"body\").addClass(\"search-without-results\");\n      }\n\n      if (inputVal.length > 0) {\n        $(\"section.content-topper .search-results-msg em\").text(\n          `'${inputVal}' (${resultsCount})`\n        );\n        // $(\"body\").addClass(\"search-with-string\");\n      }\n\n      $newSubmitButton.one(\"click\", e => {\n        e.preventDefault();\n        // if any ajax calls are active, wait for them to complete\n        if($.active) {\n          $(document).bind(\"ajaxComplete\", function(){\n            window.location = getSubmitUrl();\n          });\n        } else {\n          window.location = getSubmitUrl();\n        }\n        \n      });\n\n      $searchForm.on(\"submit\", e => {\n        e.preventDefault();\n        $newSubmitButton.trigger(\"click\");\n      });\n\n      $searchInput.keypress(e => {\n        $(\"body\").addClass(\"search-filters-changed\");\n        if (e.which === 13) {\n          $newSubmitButton.trigger(\"click\");\n        }\n      });\n\n      $addressInput.keypress(e => {\n        $(\"body\").addClass(\"search-filters-changed\");\n        if (e.which === 13) {\n          $addressInput.blur();\n          $newSubmitButton.trigger(\"click\");\n        }\n      });\n\n      $selectFilters.on(\"loaded.bs.select\", () => {\n        $(\"section.content-topper button.btn.dropdown-toggle\").keydown(e => {\n          if (e.which === 13) {\n            $newSubmitButton.trigger(\"click\");\n          }\n        });\n      });\n\n      $selectFilters.on(\"changed.bs.select\", () => {\n        $(\"body\").addClass(\"search-filters-changed\");\n      });\n\n      $(document).ready(() => {\n        if (inputVal.length > 0 || optionsValues.length > 0) {\n          $(\"body\").addClass(\"search-with-query\");\n        }\n        if (inputVal.length > 1) {\n          $(\"body\").addClass(\"search-with-term\");\n        }\n        else {\n          $(\"body\").addClass(\"search-without-term\");\n        }\n\n        $(\"body\").addClass(\"uwmbase-search-js\");\n\n      });\n\n      $(\".search-checkbox\").focus(e => {\n        $(e.target).addClass(\"active\");\n      });\n\n      $(\".search-checkbox\").blur(e => {\n        $(e.target).removeClass(\"active\");\n      });\n    }\n  };\n\n  Drupal.behaviors.getResultsCounts = {\n    attach(context, settings) {\n      const searchString = $(\n        \"body.path-search section.content-topper form.views-exposed-form input[name=s]\"\n      ).val();\n      const $providersLink = $(\n        \"body.path-search section.content-topper .other-search-pages .providers a\"\n      );\n      const $locationsLink = $(\n        \"body.path-search section.content-topper .other-search-pages .locations a\"\n      );\n      // let providersCount = 0;\n      // let locationsCount = 0;\n      //\n      // const getAlternateSearchCount = function (uri) {\n      //   $.ajax({\n      //     url: uri,\n      //     type: \"GET\",\n      //     success(data) {\n      //       return (function () {\n      //         const n = $(data)\n      //           .find(\".views-element-container > .view\")\n      //           .attr(\"data-view-total-rows\");\n      //         setCounts(uri, n);\n      //       })(data, uri);\n      //     }\n      //   });\n      // };\n      //\n      // var setCounts = function (link, count) {\n      //   if (count && count.length > 0) {\n      //     if (link.indexOf(\"providers\") > -1) {\n      //       providersCount = count;\n      //     } else if (link.indexOf(\"locations\") > -1) {\n      //       locationsCount = count;\n      //     }\n      //   }\n      //\n      //   // Only show count if search results:\n      //   if (providersCount > 0) {\n      //     $providersLink.text(`Search Providers (${providersCount}) >`);\n      //   }\n      //   if (locationsCount > 0) {\n      //     $locationsLink.text(`Search Locations (${locationsCount}) >`);\n      //   }\n      // };\n\n      if (searchString && searchString.length > 0) {\n        var href = `/search/providers?s=${encodeURI(searchString)}`;\n        $providersLink.attr(\"href\", href);\n        // getAlternateSearchCount(href);\n\n        var href = `/search/locations?s=${encodeURI(searchString)}`;\n        $locationsLink.attr(\"href\", href);\n        // getAlternateSearchCount(href);\n      }\n    }\n  };\n})(jQuery, Drupal);\n"]}