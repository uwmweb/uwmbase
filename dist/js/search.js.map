{"version":3,"sources":["search.js"],"names":["$","Drupal","behaviors","initSearchFacets","attach","context","settings","fn","selectpicker","Constructor","BootstrapVersion","resultsCount","data","$resetButton","$selects","clearSelections","showFilters","parents","addClass","showFormControls","on","removeClass","document","ready","initSearchForm","$container","$searchForm","find","$selectFilters","$searchInput","inputVal","val","$newSubmitButton","getSubmitUrl","opts","s","fs_p","f","each","g","length","window","location","pathname","param","attr","text","e","preventDefault","trigger","keypress","which","keydown","getResultsCounts","searchString","$providersLink","$locationsLink","providersCount","locationsCount","getAlternateSearchCount","uri","ajax","url","type","success","n","setCounts","link","count","indexOf","href","encodeURI","jQuery"],"mappings":"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","file":"search.js","sourcesContent":["/**\n * @file\n * Custom JavaScript for UW Medicine.\n */\n\n(function($, Drupal) {\n\n  Drupal.behaviors.initSearchFacets = {\n    attach(context, settings) {\n      $.fn.selectpicker.Constructor.BootstrapVersion = \"4\";\n\n      const resultsCount = $(\"#main-container .views-view\").data(\n        \"view-total-rows\"\n      );\n\n      const $resetButton = $(\n        \"section.content-topper .submit-wrapper .btn-cta.reset\"\n      );\n\n      const $selects = $(\"section.content-topper .selectpicker\");\n\n      const clearSelections = function() {\n        $selects.selectpicker(\"deselectAll\");\n      };\n\n      const showFilters = function() {\n        $selects.parents(\".dm-facets-selector\").addClass(\"on\");\n      };\n\n      const showFormControls = function() {\n        $(\".views-exposed-form, .submit-wrapper\").addClass(\"on\");\n      };\n\n      $selects.selectpicker();\n\n      $selects.on(\"loaded.bs.select\", () => {\n        // console.log('selects loaded');\n      });\n\n      if (resultsCount > 0) {\n        $resetButton.removeClass(\"on\");\n        showFilters();\n      } else {\n        $resetButton.addClass(\"on\");\n        clearSelections();\n      }\n\n      $(document).ready(showFormControls);\n    }\n  };\n\n  Drupal.behaviors.initSearchForm = {\n    attach(context, settings) {\n      const $container = $(\"section.content-topper\");\n      const $searchForm = $container.find(\"form.views-exposed-form\");\n      const $selectFilters = $container.find(\".selectpicker\");\n      const resultsCount = $(\"#main-container .views-view\").data(\n        \"view-total-rows\"\n      );\n      const $searchInput = $searchForm.find(\"input[name=s]\");\n      const inputVal = $searchInput.val();\n      const $newSubmitButton = $container.find(\".submit-wrapper a.btn-cta.submit\"\n      );\n\n      const getSubmitUrl = function() {\n        const opts = { s: $searchInput.val(), fs_p: [], f: [] };\n\n        $selectFilters.find(\"option:selected\").each((f, g) => {\n          const val = $(g).val();\n          if (val.length > 0) {\n            if ($selectFilters.length > 1) {\n              opts.fs_p[opts.fs_p.length] = val;\n            } else {\n              opts.f[opts.f.length] = val;\n            }\n          }\n        });\n\n        return `${window.location.pathname}?${$.param(opts)}`;\n      };\n\n      // http://stevie.uwmed.local/search/providers?fs_p[0]=language:15391&fs_p[1]=medical-service:506&fs_p[2]=medical-service:1321\n\n      $searchInput.attr(\"autocomplete\", \"off\");\n\n      if (inputVal.length > 0) {\n        $(\"section.content-topper .results-tip.with-results em\").text(\n          `'${inputVal}' (${resultsCount})`\n        );\n        $(\".results-tip.zero-results\").addClass(\"hidden\");\n        $(\".results-tip.with-results\").removeClass(\"hidden\");\n      }\n\n      $newSubmitButton.on(\"click\", e => {\n        e.preventDefault();\n        window.location = getSubmitUrl();\n      });\n\n      $searchForm.on(\"submit\", e => {\n        e.preventDefault();\n        $newSubmitButton.trigger(\"click\");\n      });\n\n      $searchInput.keypress(e => {\n        $container.addClass(\"search-filters-changed\");\n        if (e.which === 13) {\n          $newSubmitButton.trigger(\"click\");\n        }\n      });\n\n      $selectFilters.on(\"changed.bs.select\", () => {\n        $container.addClass(\"search-filters-changed\");\n      });\n\n      $selectFilters.on(\"loaded.bs.select\", () => {\n        $(\"section.content-topper button.btn.dropdown-toggle\").keydown(e => {\n          if (e.which === 13) {\n            $newSubmitButton.trigger(\"click\");\n          }\n        });\n      });\n    }\n  };\n\n  Drupal.behaviors.getResultsCounts = {\n    attach(context, settings) {\n      const searchString = $(\n        \"body.path-search section.content-topper form.views-exposed-form input[name=s]\"\n      ).val();\n      const $providersLink = $(\n        \"body.path-search section.content-topper .other-search-pages .providers a\"\n      );\n      const $locationsLink = $(\n        \"body.path-search section.content-topper .other-search-pages .locations a\"\n      );\n      let providersCount = 0;\n      let locationsCount = 0;\n\n      const getAlternateSearchCount = function(uri) {\n        $.ajax({\n          url: uri,\n          type: \"GET\",\n          success(data) {\n            return (function() {\n              const n = $(data)\n                .find(\".views-element-container > .view\")\n                .attr(\"data-view-total-rows\");\n              setCounts(uri, n);\n            })(data, uri);\n          }\n        });\n      };\n\n      var setCounts = function(link, count) {\n        if (count && count.length > 0) {\n          if (link.indexOf(\"providers\") > -1) {\n            providersCount = count;\n          } else if (link.indexOf(\"locations\") > -1) {\n            locationsCount = count;\n          }\n        }\n\n        // Only show count if search results:\n        if (providersCount > 0) {\n          $providersLink.text(`Search Providers (${providersCount}) >`);\n        }\n        if (locationsCount > 0) {\n          $locationsLink.text(`Search Locations (${locationsCount}) >`);\n        }\n      };\n\n      if (searchString && searchString.length > 0) {\n        var href = `/search/providers?s=${encodeURI(searchString)}`;\n        $providersLink.attr(\"href\", href);\n        //getAlternateSearchCount(href);\n\n        var href = `/search/locations?s=${encodeURI(searchString)}`;\n        $locationsLink.attr(\"href\", href);\n        //getAlternateSearchCount(href);\n      }\n    }\n  };\n})(jQuery, Drupal);\n"]}